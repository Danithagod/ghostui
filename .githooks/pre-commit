#!/bin/bash

# GhostUI Documentation Pre-Commit Hook
# This hook runs the documentation audit on staged component pages

set -e

# Colors for output
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

echo "üîç Running GhostUI documentation audit..."

# Get list of staged component page files
STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep "apps/docs/app/docs/components/.*/page.tsx" || true)

if [ -z "$STAGED_FILES" ]; then
  echo -e "${GREEN}‚úì No component pages modified, skipping audit${NC}"
  exit 0
fi

echo "üìÑ Checking modified component pages:"
echo "$STAGED_FILES" | sed 's/^/  - /'
echo ""

# Change to docs directory and run audit
cd apps/docs

# Run quick audit check
npm run audit:check 2>&1

AUDIT_EXIT_CODE=$?

cd ../..

if [ $AUDIT_EXIT_CODE -ne 0 ]; then
  echo ""
  echo -e "${RED}‚ùå Documentation audit failed!${NC}"
  echo ""
  echo "To fix these issues:"
  echo "  1. Run: cd apps/docs && npm run audit"
  echo "  2. Review the issues in the report"
  echo "  3. Apply automated fixes: npm run audit -- --fix"
  echo "  4. Manually fix remaining issues"
  echo ""
  echo "To bypass this check (not recommended):"
  echo "  git commit --no-verify"
  exit 1
fi

echo ""
echo -e "${GREEN}‚úì Documentation audit passed!${NC}"
exit 0
